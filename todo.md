# FCL Website NEXT - 任务清单

## 项目概述
FCL (Furnace Craft Launcher) 下载站 - 为 Fold Craft Launcher (FCL) 和 Zalith Launcher (ZL) 社区搭建的现代化、高性能下载站。由玩家社区维护，提供 FCL 和 ZL 启动器及其相关资源（如渲染器、驱动、Java 等）的快速下载。

## 当前状态
- ✅ 项目结构已建立
- ✅ 基础文件已创建
- ✅ 核心功能已完成
- ✅ UI重构已完成
- 🔄 测试优化进行中

## 待办事项

### 历史任务

2025年项目重构 [x] FCL下载站现代化重构 ✅
- [x] 熟悉旧网页结构和功能（MDUI框架）
- [x] 分析旧项目技术栈和代码结构
- [x] 设计新的现代化UI架构
- [x] 采用Tailwind CSS + FontAwesome技术栈
- [x] 实现青绿色主题设计
- [x] 重写所有JavaScript逻辑（不复制旧代码）
- [x] 保留下载功能，为其他功能预留接口
- [x] 实现线路延迟检测功能
- [x] 实现智能线路选择功能
- [x] 实现设备架构检测功能
- [x] 构建响应式设计适配多端
- [x] 优化性能和可访问性
- [x] 建立模块化代码结构
- [x] 创建纯静态网站架构

2025/9/22 [x] 安装Playwright测试框架 ✅
- [x] 安装Playwright依赖
- [x] 配置Playwright环境
- [x] 创建测试用例
- [x] 运行测试验证 (核心测试 15/20 通过)
- [x] 优化测试配置和用例
- [x] 创建使用指南文档
- [x] 配置npm脚本命令
- [ ] 修复移动端菜单测试稳定性问题 (5个测试失败，待后续优化)

2025/9/22 [x] 修复下载页折叠菜单max-height不会更新的问题 ✅
- [x] 分析问题根本原因（硬编码scrollHeight、内容变化未重新计算）
- [x] 查看ReusableCollapsiblePanel组件的实现
- [x] 查看下载页面的HTML结构
- [x] 研究downloads.js中的折叠逻辑
- [x] 实现ResizeObserver监听内容变化
- [x] 添加50px缓冲区确保内容完全显示
- [x] 设置2000px最大高度限制防止异常
- [x] 动画完成后重置max-height为none
- [x] 创建test-collapse-fix.html测试页面
- [x] 验证不同内容长度下的动画效果
- [x] 测试移动端和桌面端兼容性



### 低优先级任务
- [ ] 代码重构和优化
- [ ] 添加测试用例
- [ ] 文档完善
- [ ] 完善页面组件
- [ ] 添加新的功能模块
- [ ] 优化用户体验

### 下一步建议
- [ ] 考虑将下载页的折叠逻辑迁移到 ReusableCollapsiblePanel 组件
- [ ] 添加更多自动化测试用例
- [ ] 优化移动端折叠面板的用户体验
- [ ] 进一步优化模块化结构，考虑实现懒加载机制

## 最近完成的任务
- [x] 初始化todo.md文件

## 操作记录

### 2025年9月 - index.html模块化重构
- **重构目标**: 将单体index.html文件拆分为模块化结构，提高代码可维护性
- **拆分内容**: 
  - 将页面拆分为header、navigation、footer等独立模块
  - 创建对应的HTML文件（header.html、navigation.html、footer.html）
  - 分离页面内容到专门的模块文件（home.html、downloads.html等）
- **技术实现**:
  - 使用JavaScript动态加载各个模块
  - 实现模块间的依赖管理和加载顺序
  - 保持原有功能和样式的一致性
- **问题解决**:
  - 修复模块化加载导致的DOM元素访问时序问题
  - 确保所有功能在模块化后正常工作
  - 优化加载性能和用户体验
- **优势提升**:
  - 代码可维护性显著提高，各模块可独立开发和维护
  - 支持并行开发，不同开发者可同时处理不同模块
  - 便于性能优化和按需加载
  - 页面结构更清晰，便于理解和扩展

### 2025年9月 - Playwright测试框架集成
- **安装配置**: 成功安装Playwright测试框架，配置多浏览器测试环境
- **测试用例**: 创建核心功能测试和主页功能测试
- **当前状态**: 核心测试15/20通过，移动端菜单测试存在稳定性问题
- **已知问题**: 移动端菜单切换测试在5个浏览器环境中失败，需要优化选择器逻辑
- **后续优化**: 需要进一步分析移动端菜单的CSS类切换机制，改进测试稳定性

### 2025年9月 - 下载页折叠菜单动态高度修复
- **问题发现**: 下载页面折叠菜单在内容动态变化时max-height不会更新，导致内容显示不完整
- **技术分析**: 
  - 使用固定scrollHeight值，未考虑内容变化
  - 缺乏动态高度调整机制
  - 未采用统一的折叠组件标准
- **解决方案**: 
  - 实现ResizeObserver监听内容尺寸变化
  - 动态计算并更新max-height值
  - 添加50px缓冲区确保内容完整性
  - 设置2000px最大高度限制防止异常
  - 动画完成后重置max-height为none
- **测试验证**: 创建test-collapse-fix.html测试页面，验证不同场景下的折叠效果
- **兼容性**: 确认移动端和桌面端正常工作
- **代码改进**: 优化性能，减少重排重绘，添加错误处理机制

---

## 开发规范
1. 每次修改前先阅读相关文档
2. 修改后及时更新todo.md
3. 分步骤执行，避免一次性大量修改
4. 注意Windows/Linux系统兼容性
5. 使用相对路径

## 项目状态总结
✅ **已完成**: 
- 项目初始化、功能模块分析
- 旧项目重构分析（MDUI → Tailwind CSS）
- UI现代化重构（青绿色主题、响应式设计）
- 核心功能实现（多线路下载、智能选择、设备检测）
- JavaScript模块化重写
- ReusableCollapsiblePanel组件开发
- 下载页折叠菜单动态高度修复
- Playwright测试框架集成
- index.html模块化重构（header、navigation、footer等模块分离）

🔄 **进行中**: 
- 测试用例优化（移动端菜单测试稳定性）
- 代码性能优化
- 用户体验改进

📋 **待开始**: 
- 下载页折叠逻辑统一迁移到ReusableCollapsiblePanel
- 更多自动化测试用例开发
- 移动端交互体验优化
- 文档完善和代码重构