# FCL 下载站 - 任务清单


## 下一步计划

### 代码优化
- [ ] 合并src/pages/和src/modules/html/目录下的文件
- [ ] 优化JavaScript模块结构
- [ ] 添加TypeScript类型定义
- [ ] 实现代码分割和懒加载
- [ ] 添加单元测试

### UI/UX改进

- [x] 为折叠面板组件添加深色模式支持
- [x] 修复下载页折叠面板使用不规范问题
- [x] 修复下载页折叠面板深色模式边框不可见问题
- [x] 修复下载页折叠面板的子面板点不开问题
## 将下载页的线路特点和贡献改成icon加小胶囊样式
- [x] 分析当前线路特点和贡献的显示方式
- [x] 设计小胶囊样式和图标映射
- [x] 创建小胶囊的CSS样式
- [x] 修改downloads.js中的显示逻辑
- [x] 测试修改后的效果 ✅ 已完成
- [x] 将图标信息放入JSON配置（根据用户要求）

### 任务分析
当前下载页的线路特点和贡献显示方式为文本格式：`线路名称 (特点) [贡献者]`

**需要修改的内容：**
1. **线路特点**：`(已开学)`、`(更新快)`、`(全版本)`、`(速度快)`、`(高防御)`
2. **贡献者**：`[站长提供]`、`[哈哈66623332提供]`、`[fishcpy提供]`等

**修改目标：**
改为小胶囊样式：`<div class="胶囊样式"><图标>文字</div>`

**实施步骤：**
1. 为每种特点设计对应的图标
2. 为贡献者信息设计对应的图标  
3. 创建小胶囊的CSS样式（圆角、背景颜色等）
4. 修改downloads.js中的显示逻辑
5. 测试修改后的效果
- [ ] 添加页面过渡动画
- [ ] 优化移动端触摸体验
- [ ] 改进错误页面设计
- [ ] 添加暗黑模式切换动画

### 功能增强
- [ ] 添加多语言支持
- [ ] 实现用户偏好设置
- [ ] 添加下载历史记录
- [ ] 实现离线访问支持



## 已知问题

- 某些外部资源在开发者模式下被拦截（预期行为）

## 分支管理

### Beta分支创建
- [x] **创建beta分支用于实验特性**
  - [x] 从main分支创建beta分支
  - [x] 切换到beta分支
  - [x] 验证分支切换成功
  - [x] 记录操作到todo.md

**操作详情：**
- **时间**：2024年（具体时间由系统记录）
- **操作**：从main分支创建并切换到beta分支
- **当前分支**：beta
- **目的**：用于实验新特性和功能测试
- **状态**：✅ 已完成

# 任务列表

## 日志太多
- [x] 确定日志太多的地方
- [x] 加入console.groupCollapsed()

## 公告页配色不正常
- [x] 分析公告页配色问题的具体表现
- [x] 检查玻璃效果与背景颜色的冲突
- [x] 修复公告页配色问题
- [x] 测试修复后的配色效果
- [x] **优化历史公告区域配色方案**
  - [x] 分析历史公告区域看不清的具体问题
  - [x] 检查未应用半透明背景的子面板
  - [x] 优化文字颜色和对比度
  - [x] 测试优化后的可读性

### 修复详情

### 问题分析
历史公告区域中部分子面板仍然使用纯色背景（bg-gray-50），没有应用半透明效果，导致在玻璃效果下文字可读性不佳。

### 修改内容
修复了历史公告区域中以下子面板的背景颜色：
1. **欢迎访问FCL下载站！**子面板：添加`bg-gray-50/80 dark:bg-gray-800/80`和`bg-white/80 dark:bg-gray-900/80`类
2. **PojavLauncher停更**子面板：添加`bg-gray-50/80 dark:bg-gray-800/80`和`bg-white/80 dark:bg-gray-900/80`类  
3. **下载站现状**子面板：添加`bg-gray-50/80 dark:bg-gray-800/80`和`bg-white/80 dark:bg-gray-900/80`类

### 测试结果
修改后历史公告区域配色协调，所有子面板都应用了半透明背景，文字在玻璃效果下具有良好的可读性。



## 问题分析
公告页使用`glass-effect`玻璃效果样式，该样式在深色模式下设置`color: #000`（黑色文字），而公告页内容区域使用`bg-white`（白色背景），导致黑色文字在白色背景上显示且玻璃效果产生视觉冲突。

### 修改内容
1. **移除外层容器白色背景**：将`<div class="bg-white rounded-lg overflow-hidden">`修改为`<div class="rounded-lg overflow-hidden">`
2. **优化玻璃效果样式**：
   - 默认背景从`#00000044`改为`rgba(0, 0, 0, 0.3)`
   - 深色模式下文字颜色从`#000`改为`#fff`
   - 深色模式下背景从`#FFFFFF44`改为`rgba(255, 255, 255, 0.1)`
3. **添加内容区域半透明背景**：为所有公告内容区域添加`bg-white/80 dark:bg-gray-900/80`类
4. **修复面板标题背景**：为所有面板标题添加`bg-gray-50/80 dark:bg-gray-800/80`类

### 测试结果
修改后公告页配色恢复正常，玻璃效果与内容区域协调，文字可读性良好。

## 在所有this.log前加入console.log ✅
- [x] 分析devModeCore.js中所有this.log调用位置
- [x] 在每个this.log调用前添加对应的console.log
- [x] 测试修改后的日志输出功能
- [x] 验证开发者模式日志系统正常工作

**修改详情：**
- 在PerformanceMonitor类的2个this.log调用前添加了console.log
- 在NetworkAnalyzer类的1个this.log调用前添加了console.log  
- 在ErrorCapture类的1个this.log调用前添加了console.log
- 在MemoryMonitor类的1个this.log调用前添加了console.log
- 在DevModeManager类的9个this.log调用前添加了console.log
- 总共在14个this.log调用前添加了对应的console.log输出

**测试结果：** ✅ 功能完全正常，所有日志现在都会同时输出到控制台和开发者模式日志系统

## 统一开发者模式按钮实现详细计划 ✅

**问题分析**：
- 当前项目中存在两个开发者模式按钮：
  1. `dev-mode-toggle`（在devMode.js中创建）：主切换按钮，用于启用/禁用开发者模式
  2. `dev-mode-quick-access`（在devModePanel.js中创建）：快速访问按钮，用于打开开发者面板
- 两个按钮都固定在右下角，位置重叠，造成视觉混乱
- 功能分散，用户体验不佳

**解决方案**：
- 统一使用一个按钮实现所有功能
- 按钮点击行为：
  - 如果开发者模式未启用：点击后启用开发者模式并打开面板
  - 如果开发者模式已启用：点击后打开/关闭面板
- 按钮样式根据状态变化：
  - 禁用状态：灰色背景
  - 启用状态：蓝色背景（与当前quick-access按钮一致）

**实施步骤**：
1. [x] 修改devMode.js，移除dev-mode-toggle按钮创建逻辑
2. [x] 修改devModePanel.js，调整dev-mode-quick-access按钮的行为
3. [x] 更新按钮点击事件处理逻辑
4. [x] 更新按钮样式和状态同步
5. [x] 测试统一后的按钮功能
6. [x] 更新相关文档和注释

**测试结果**：✅ 功能完全正常，按钮状态切换正确，面板开关功能正常

2. **性能优化**
   - 进一步优化页面加载速度
   - 添加资源缓存策略
   - 优化图片加载

3. **用户体验改进**
   - 收集用户反馈
   - 优化界面交互细节
   - 改进错误处理

## 修复开发者模式面板功能
- [x] 添加开发者模式面板关闭功能（禁用开发者模式）
- [x] 实现开发者模式面板拖动功能
- [x] 优化面板用户体验

测试结果：✅ 功能完全正常
- 关闭按钮功能：✅ 点击关闭按钮成功禁用开发者模式，更新URL参数为dev=0，面板正确隐藏
- 拖动功能：✅ 面板支持鼠标和触摸拖动，限制在窗口范围内移动
- 重新启用：✅ 通过主按钮可重新启用开发者模式，URL参数更新为dev=1，面板正确隐藏

## 优化开发者模式核心逻辑
- [x] 提升 `dev=0` 参数优先级，使其高于localhost自动启用
- [x] 优化开发者模式UI，添加禁用按钮
- [x] 修复开发者模式下的网络请求拦截逻辑
- [x] 添加开发者模式状态持久化
- [x] **已修复**：普通用户模式下notification通知显示问题（执行顺序问题）
- [x] **统一开发者模式按钮实现**：当前存在两个按钮（dev-mode-toggle和dev-mode-quick-access），需要统一为一个按钮实现
    - [x] 确认`testAndroidVersion`函数在开发者模式下仍被调用
    - [x] 验证开发者模式不影响userAgent检测
    - [x] 调查为什么开发者模式下缺少"安卓版本检测"日志输出（已解决：普通模式也缺失）
    - [x] 测试notification组件在开发者模式下的实际行为
    - [x] **根本原因**：`testAndroidVersion`和`showDeviceSuggestions`并行执行，存在竞态条件
    - [x] **问题定位**：`testAndroidVersion`依赖`androidVer`变量，但该变量由`showDeviceSuggestions`设置
    - [x] **已修复**：在`main.js`中使用async/await确保执行顺序，在`indexDownLinks.js`中添加延迟执行
  - [x] **已修复**：开发者模式下notification通知显示问题（将自定义showNotification改为使用统一notification通知系统）
  **测试结果**：✅ 功能完全正常，按钮状态切换正确，面板开关功能正常

## 修改开发者模式关闭逻辑
- [x] **任务**：把开发者模式的逻辑改为：页面内只能通过配置里的按钮来关闭
- [x] **问题分析**：当前开发者模式可以通过多种方式关闭：
  1. 面板关闭按钮
  2. URL参数变化（popstate事件）
  3. 自动逻辑（无dev参数且非localhost时）
- [x] **解决方案**：移除所有其他关闭途径，只保留配置面板中的关闭按钮
- [x] **修改步骤**：
  1. 移除devMode.js中的popstate事件监听器
  2. 移除自动关闭逻辑
  3. 确保只有配置面板中的关闭按钮可以禁用开发者模式
- [x] **预期结果**：开发者模式只能通过配置面板中的关闭按钮来禁用

**修改详情**：
- **devMode.js**：移除了popstate事件监听器，删除了URL参数变化和自动关闭逻辑
- **devModePanel.js**：
  - 移除了标题栏中的关闭按钮
  - 在配置面板中添加了专门的关闭按钮
  - 为配置面板关闭按钮添加了确认对话框和事件处理

**完成状态**：✅ 已完成

## 将最小化按钮改为关闭按钮
- [x] **任务目标**：将开发者模式面板中的最小化按钮改为关闭按钮
- [x] **修改详情**：
  - **devModePanel.js**：
    - 将标题栏中的最小化按钮改为关闭按钮（更改按钮ID和图标）
    - 将最小化按钮的事件绑定改为关闭面板的功能
    - 现在标题栏的关闭按钮会隐藏面板，而配置面板中的关闭按钮会禁用开发者模式并刷新页面
- [x] **修改结果**：
  - ✅ 标题栏的关闭按钮：隐藏开发者模式面板
  - ✅ 配置面板中的关闭按钮：禁用开发者模式并刷新页面
  - ✅ 保持了之前修改的逻辑（只能通过配置面板中的按钮来禁用开发者模式）
- [x] **完成状态**：✅ 已完成

## 开发者模式调试通知模块
- [x] **任务目标**：为开发者模式添加通知调试功能，包含各种颜色、样式和长度的通知测试界面
- [x] **修改详情**：
  - **devModePanel.js**：
    - 添加"通知"标签页到开发者模式面板
    - 创建renderNotifications方法，实现通知调试界面
    - 添加快速测试按钮（成功、警告、错误、信息四种类型）
    - 添加自定义通知设置（类型、位置、消息长度、自定义消息）
    - 添加批量操作功能（清除所有通知、顺序测试）
    - 添加通知历史记录功能
    - 实现各种通知测试方法
    - 导入Notification类确保功能正常
- [x] **修改结果**：
  - ✅ 成功添加"通知"标签页到开发者模式面板
  - ✅ 实现完整的通知调试界面，包含：
    - 快速测试区域：四种颜色/类型的通知按钮（绿色-成功、黄色-警告、红色-错误、蓝色-信息）
    - 自定义通知设置：可选择通知类型、显示位置（6种位置）、消息长度（短/中/长）、自定义消息
    - 批量操作：清除所有通知、顺序测试功能
    - 通知历史记录：显示最近10条通知记录，包含时间戳和类型图标
  - ✅ 实现所有通知测试功能：

## 修复开发者模式面板自动刷新问题
- [x] **任务目标**：修复开发者模式面板因自动刷新导致无法选中元素的问题
- [x] **问题分析**：devModePanel.js中的startAutoUpdate方法设置了每秒执行一次的定时器，导致面板内容频繁刷新，DOM元素重渲染，无法选中
- [x] **解决方案**：添加暂停/恢复自动更新功能，允许用户控制刷新频率
- [x] **修改详情**：
  - **devModePanel.js**：
    - 在构造函数中添加isAutoUpdatePaused状态变量
    - 修改startAutoUpdate方法，添加暂停状态检查
    - 添加pauseAutoUpdate、resumeAutoUpdate、toggleAutoUpdate方法
    - 添加updateStatus方法更新状态显示
    - 在标题栏添加暂停按钮
    - 在bindEvents方法中添加暂停按钮事件绑定
- [x] **修改结果**：
  - ✅ 成功添加自动更新暂停/恢复功能
  - ✅ 面板默认每秒自动刷新，但用户可以通过暂停按钮停止刷新
  - ✅ 暂停状态下，面板内容不再自动刷新，可以正常选中元素
  - ✅ 状态栏显示当前自动更新状态（运行中/已暂停）
  - ✅ 暂停按钮支持切换功能，点击可在暂停和恢复状态间切换
- [x] **预期结果**：用户可以通过暂停按钮控制自动刷新，解决无法选中元素的问题
- [x] **完成状态**：✅ 已完成

## 为开发者模式添加更多配置参数
- [x] **任务目标**：为开发者模式添加更多可配置的参数，增强调试功能
- [x] **新增参数计划**：
  - 自动更新频率设置（1-10秒）
  - 通知显示时长设置（1-10秒）
  - 网络请求延迟模拟（0-5000ms）
  - 错误模拟功能（模拟不同类型错误）
  - 性能监控采样频率（100ms-5000ms）
  - 内存监控采样频率（1000ms-10000ms）
- [x] **修改详情**：
  - **devModeCore.js**：扩展配置结构，添加新参数
  - **devModePanel.js**：在配置面板中添加新的配置项
  - 实现参数的实际功能逻辑
- [x] **预期结果**：用户可以通过配置面板调整更多调试参数，增强开发者模式的灵活性
- [x] **完成状态**：已完成

## 加强通知测试功能
- [x] **任务目标**：增强开发者模式中的通知测试功能，提供更全面的测试场景和工具
- [x] **新增功能计划**：
  - 通知堆叠测试 - 同时显示多个通知的堆叠效果测试
  - 性能压力测试 - 批量生成通知的性能测试
  - 边界条件测试 - 超长消息、特殊字符等边界情况测试
  - 交互测试 - 鼠标悬停、点击行为等交互测试
  - 样式自定义测试 - 自定义颜色、动画等样式测试
  - 通知生命周期测试 - 通知显示、关闭等生命周期测试
- [x] **修改详情**：
  - 扩展devModePanel.js中的通知测试界面
  - 添加新的测试按钮和配置选项
  - 实现通知堆叠测试逻辑
  - 添加性能压力测试功能
  - 实现边界条件测试功能
  - 添加交互测试功能
  - 实现样式自定义测试
  - 更新通知历史记录功能
- [x] **预期结果**：
  - 通知测试功能更加全面，覆盖各种使用场景
  - 支持复杂的通知堆叠和性能测试
  - 提供边界条件和交互行为的测试工具
  - 增强通知系统的调试和测试能力
- [x] **完成状态**：已完成

## 修复顶部居中和底部居中位置逻辑问题
- [x] **任务目标**：修复通知组件中顶部居中和底部居中位置显示逻辑不正常的问题
- [x] **问题分析**：
  - 在`applyStackOffset`方法中，对于居中位置的处理存在逻辑问题
  - 当多个通知堆叠时，`transform`属性被错误覆盖，导致垂直堆叠效果丢失
  - 居中位置的水平居中效果可能被垂直偏移计算干扰
- [x] **修复计划**：
  - 修改`applyStackOffset`方法中的居中位置处理逻辑
  - 确保垂直偏移正确应用，同时保持水平居中效果
  - 测试修复后的居中位置堆叠效果
- [x] **修改详情**：
  - 分析notification.js中的堆叠管理器逻辑
  - 修复`applyStackOffset`方法中的居中位置处理
  - 添加详细的日志输出以调试位置计算
  - 测试所有位置类型的堆叠效果
- [x] **修改结果**：
  - 修复了`applyStackOffset`方法中的居中位置处理逻辑
  - 现在对于居中位置，会正确保持水平居中效果，同时应用垂直堆叠偏移
  - 改进了transform属性的处理，避免覆盖scale动画效果
  - 添加了智能的transform值检测，确保不重复设置translateX(-50%)
- [x] **预期结果**：
  - 顶部居中和底部居中位置的通知能够正确堆叠显示
  - 水平居中效果保持不变
  - 垂直方向的堆叠偏移正确计算
- [x] **完成状态**：✅ 已完成

## 修复testExtremeTime位置跟随设置问题
- [x] **任务目标**：修复devModePanel.js中testExtremeTime方法的位置设置问题，使其能够跟随用户选择的位置设置
- [x] **问题分析**：
  - testExtremeTime方法中使用了固定的位置设置（'top-right'和'top-left'），没有获取用户当前选择的位置
  - 无论用户在位置选择器中选择什么位置，极值时间测试都会在固定位置显示通知
  - 极值时间测试功能的位置设置不跟随用户选择
- [x] **修复计划**：
  - 分析testExtremeTime方法的当前实现
  - 查看testNotification方法中如何获取位置选择器值
  - 修改testExtremeTime方法，使其跟随用户选择的位置
  - 测试修复后的位置跟随功能
- [x] **修改详情**：
  - 修改testExtremeTime方法，获取位置选择器值
  - 使用获取的位置值替换固定位置设置
  - 确保极短时间和极长时间测试都使用相同的位置
  - 保持原有的测试逻辑不变
- [x] **修改结果**：
  - ✅ 位置选择器集成：testExtremeTime方法现在会获取用户选择的位置设置
  - ✅ 统一位置使用：极短时间和极长时间测试都使用相同的位置设置
  - ✅ 跟随用户选择：位置选择器的设置现在对所有测试功能生效
  - ✅ 向后兼容：保持原有的测试逻辑和功能不变
- [x] **预期结果**：
  - ✅ 极值时间测试能够跟随用户选择的位置设置
  - ✅ 极短时间和极长时间测试使用相同的位置
  - ✅ 位置选择器的设置对所有测试功能生效
- [x] **完成状态**：✅ 已完成

## 修复居中位置通知堆叠transform属性问题
- [x] **任务目标**：修复notification.js中居中位置通知堆叠时transform属性不一致的问题
- [x] **问题分析**：
  - 第一条居中通知的transform属性为`scale(1)`，第二条通知变为`translateX(-50%) scale(1)`，导致显示不一致
  - 第一条通知缺少`translateX(-50%)`水平居中变换，第二条通知正确包含
  - 影响所有使用'top-center'和'bottom-center'位置的通知堆叠显示
- [x] **修复计划**：
  - 分析notification.js中的applyStackOffset方法
  - 查看居中位置transform属性的处理逻辑
  - 修复transform属性不一致的问题
  - 测试修复后的居中位置堆叠功能
- [x] **修改详情**：
  - 修改show方法中的动画触发逻辑
  - 修复第一条通知缺少translateX(-50%)的问题
  - 保持scale动画效果不变
  - 确保垂直堆叠偏移计算正确
- [x] **修改结果**：
  - **智能transform处理**：show方法现在会根据位置类型智能设置transform属性
  - **居中位置保持**：对于居中位置，transform属性始终包含`translateX(-50%) scale(1)`
  - **非居中位置**：其他位置保持原有的`scale(1)`设置
  - **动画效果保持**：所有动画效果和过渡效果保持不变
- [x] **预期结果**：
  - ✅ 所有居中位置通知都包含`translateX(-50%)`水平居中变换
  - ✅ 第一条和第二条通知的transform属性保持一致
  - ✅ 水平居中和垂直堆叠效果正常工作
  - ✅ scale动画效果不受影响
- [x] **完成状态**：✅ 已完成

## 统一消失动画效果
- [x] **任务目标**：修复居中位置通知消失动画往右飘的问题，统一所有位置的消失动画效果
- [x] **问题分析**：
  - 居中位置通知在消失时transform属性被设置为`scale(0.95)`，丢失了`translateX(-50%)`
  - 导致通知在消失时往右飘，而不是保持水平居中
  - 影响所有使用'top-center'和'bottom-center'位置的通知消失动画
- [x] **修复计划**：
  - 分析notification.js中close方法的消失动画逻辑
  - 修复居中位置消失动画的transform属性处理
  - 统一所有位置的消失动画效果
  - 测试修复后的消失动画效果
- [x] **修改详情**：
  - 修改close方法中的消失动画逻辑
  - 修复居中位置消失动画往右飘的问题
  - 保持scale动画效果不变
  - 确保所有位置消失动画效果一致
- [x] **修改结果**：
  - **智能transform处理**：close方法现在会根据位置类型智能设置transform属性
  - **居中位置保持**：对于居中位置，消失动画transform属性包含`translateX(-50%) scale(0.95)`
  - **非居中位置**：其他位置保持原有的`scale(0.95)`设置
  - **动画效果统一**：所有位置的消失动画效果保持一致
- [x] **预期结果**：
  - ✅ 所有居中位置通知消失时保持水平居中
  - ✅ 消失动画不会往右飘
  - ✅ 所有位置的消失动画效果统一
  - ✅ scale动画效果不受影响
- [x] **完成状态**：✅ 已完成

## 修复downloads.js中versionDir未定义错误
- [x] **任务目标**：修复downloads.js第88行ReferenceError: versionDir is not defined错误
- [x] **问题分析**：
  - 第88行代码`console.groupCollapsed(`${lineName}：创建版本面板 ${versionDir.name}`);`中使用了`versionDir.name`
  - 但`versionDir`变量是在`versionDirs.forEach`循环中才定义的，此时还未定义
  - 导致所有下载线路都出现ReferenceError错误
- [x] **修复计划**：
  - 分析downloads.js中loadFclDownWay函数的代码结构
  - 修复console.groupCollapsed语句中的变量引用错误
  - 测试修复后的下载功能
- [x] **修改详情**：
  - 修改console.groupCollapsed语句，移除对未定义变量的引用
  - 确保代码逻辑正确
  - 保持其他功能不变
- [x] **修改结果**：
  - **修复变量引用错误**：将`console.groupCollapsed(`${lineName}：创建版本面板 ${versionDir.name}`);`改为`console.groupCollapsed(`${lineName}：创建版本面板`);`
  - **保持功能完整**：移除了对未定义变量的引用，但保持了日志功能
  - **代码逻辑正确**：现在console.groupCollapsed语句不再引用未定义的变量
- [x] **预期结果**：
  - ✅ 所有下载线路正常加载，不再出现ReferenceError错误
  - ✅ 版本面板正确显示
  - ✅ 下载功能正常工作
- [x] **完成状态**：✅ 已完成

    - testNotification：测试单个通知
    - testCustomNotification：测试自定义通知
    - testAllNotifications：批量测试所有类型通知
    - testNotificationSequence：顺序测试通知序列
    - clearAllNotifications：清除所有通知
  - ✅ 添加通知历史记录功能，支持实时更新和历史管理
- [x] **预期结果**：
  - ✅ 用户可以在开发者模式面板中测试各种通知
  - ✅ 支持不同颜色、样式、长度的通知
  - ✅ 提供完整的通知调试工具
- [x] **完成状态**：✅ 已完成



## 修复线路选择器为空问题 ✅
- [x] **问题分析**：`populateLineSelection()`在`DOMContentLoaded`时执行，但home.html模块通过异步加载，存在时序问题
- [x] **解决方案**：将`populateLineSelection()`调用延迟500ms执行，确保home.html模块加载完成
- [x] **验证修复**：线路选择器选项已正确填充，setupIndexDownLinks正常调用
- [x] **测试**：所有线路选择功能正常工作，控制台显示智能线路选择初始化成功

## 修复错误状态下切换线路仍然报错问题 ✅
- [x] **问题**：当显示"抱歉，我们遇到了一个无法解决的问题。"错误时，切换线路仍然会报错
- [x] **问题分析**：错误发生后，线路选择器没有被禁用或重置，导致用户切换线路时仍然会触发失败的setupIndexDownLinks()调用
- [x] **解决方案**：在错误处理逻辑中添加线路选择器禁用状态管理
- [x] **修复文件**：src/modules/indexDownLinks.js
- [x] **修复步骤**：
  1. 在错误处理catch块中添加线路选择器禁用逻辑
  2. 在成功执行try块中添加线路选择器启用逻辑
  3. 确保错误状态下线路选择器被禁用，防止用户切换线路
- [x] **验证修复**：错误状态下线路选择器会被禁用，成功状态下会重新启用
- [x] **状态**：已完成

## 替换玻璃设计
- [x] 分析项目中所有玻璃设计元素
- [x] 统一使用新的玻璃设计样式
- [x] 测试玻璃设计在不同组件中的表现
- [x] 验证玻璃设计与项目整体风格一致

## 把所有的alert改成notification通知 ✅
- [x] 分析项目中所有alert使用位置
- [x] 创建通用的notification通知组件(src/utils/notification.js)
- [x] 更新notice.js中的alert为Notification.error
- [x] 更新deviceSuggestions.js中的alert为Notification.warning
- [x] 测试notification组件功能
- [x] 验证notification通知在开发者模式下的行为
- [x] 确认开发者模式会阻止外部请求但不影响userAgent检测
- [x] 测试非开发者模式下notification通知正常工作

## 修复移动端导航栏功能异常 - 替换为桌面端导航栏样式 ✅
- [x] 分析移动端导航栏问题
- [x] 统一使用桌面端导航栏样式
- [x] 优化导航栏响应式设计
- [x] 测试导航栏在各种设备上的表现

## 修复下载功能异常 ✅
- [x] 分析下载链接加载失败原因
- [x] 优化下载链接获取逻辑
- [x] 添加下载失败重试机制
- [x] 改进错误提示信息

## 优化页面加载性能 ✅
- [x] 添加智能线路选择功能
- [x] 优化资源加载顺序
- [x] 添加页面加载状态指示
- [x] 实现下载链接预加载

## 修复设备检测功能 ✅
- [x] 优化设备信息检测逻辑
- [x] 改进系统兼容性判断
- [x] 添加设备建议功能
- [x] 修复Android版本检测逻辑




## 文档完善
- [x] 创建AI更改指南文档（`docs/AI_CHANGE_GUIDE.md`）
  - [x] 包含完整的更改流程和最佳实践
  - [x] 提供常见陷阱和解决方案
  - [x] 详细的测试验证步骤
  - [x] 应急处理方案
- [x] **增强AI更改指南**：补充了36-40行指导原则的缺失内容
  - [x] 添加测试验证环节（功能测试、兼容性测试、性能测试）
  - [x] 明确代码质量要求（错误处理、内存管理、代码风格）
  - [x] 增加版本管理和备份指导
  - [x] 强化性能监控要求
  - [x] 突出用户体验优先原则


## 删除toast.js文件 ✅
- [x] 检查项目中是否还有模块引用toast.js
- [x] 确认所有模块已迁移到notification.js
- [x] 删除toast.js文件
- [x] 更新项目文档

## 从devMode.js提取通用通知组件 ✅
- [x] 分析现有的showDevModeNotification函数实现
- [x] 创建通用的Notification组件
- [x] 更新devMode.js使用新的通用组件
- [x] 创建测试页面(test-notification.html)
- [x] 将Tailwind CSS类替换为内联样式（解决CSS文件加载问题）
- [x] 修复closeAll方法的选择器问题
- [x] 添加调试信息定位问题
- [x] **修复问题**：修复模块导入问题，通知元素现在正常显示
- [x] 测试通知组件功能
- [x] 添加通知堆叠功能（多个通知分行显示）
- [x] **修复堆叠通知显示问题**：修复通知内容超过三行时的堆叠重叠问题
- [x] **增强阴影效果**：增强通知阴影，提升视觉层次感
- [x] UI/UX改进：优化通知动画效果
- [x] 响应式设计：适配移动端显示
- [x] 添加更多通知类型和自定义选项
- [x] 更新项目文档

## 修复堆叠通知显示问题详情
**问题描述：**
- 原堆叠管理器使用固定60px高度计算堆叠偏移，导致通知内容超过三行时出现重叠
- 通知阴影效果太淡，视觉层次感不足

**修复方案：**
1. **动态高度计算：** 将固定60px高度改为动态计算通知实际高度 + 20px间距
2. **阴影增强：** 将阴影值从`0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)`增强为`0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.08)`
3. **高度估算优化：** 添加元素未完全渲染时的高度估算逻辑

**测试验证：**
- 创建test-notification-fix.html测试页面
- 验证短文本、中等长度、长文本通知的堆叠效果
- 测试阴影增强效果
- 验证不同类型通知的显示效果

**结果：**
- 堆叠通知显示正常，无重叠问题
- 阴影效果明显增强，视觉层次感提升
- 通知组件功能完整，响应式设计良好

**问题分析：**
- 当前`devMode.js`中的`showDevModeNotification`函数实现了基本的通知功能
- 功能包括：创建通知元素、设置样式、自动移除、淡入淡出动画
- 项目中已存在`src/utils/notification.js`通知组件，功能完善且被多个模块使用

**当前状态：**
- ✅ 已创建`src/utils/notification.js`通用通知组件
- ✅ 支持多种通知类型（success、warning、error、info）
- ✅ 支持自定义位置、持续时间、动画效果
- ✅ 已更新devMode.js使用新的通知组件
- ✅ 已创建测试页面并添加详细测试功能
- ✅ 已将Tailwind CSS类替换为内联样式（解决CSS文件加载404错误）
- ✅ 已修复closeAll方法的选择器问题
- ✅ 已添加调试信息

**当前问题：**
- 测试页面按钮点击事件正常触发，但通知元素不显示
- 控制台没有显示通知相关的调试日志，说明show方法没有被调用
- 可能的问题：模块导入失败、路径错误、语法错误

**下一步计划：**
1. 检查notification.js文件语法错误
2. 检查测试页面导入路径是否正确
3. 检查模块导入是否成功
4. 添加更多调试信息定位具体问题

**决策：**
- 保持两个通知组件独立，因为：
  - toast组件已被多个模块使用，修改会影响现有功能
  - Notification组件提供更现代的API设计
  - 两个组件可以共存，服务于不同的使用场景


## 修复index.html和main.js的内容加载冲突 ✅
- [x] **问题分析**：index.html中的模块加载脚本和main.js中的DOMContentLoaded事件监听器存在执行顺序冲突
- [x] **问题定位**：main.js在index.html模块加载完成前就执行了DOMContentLoaded事件处理，导致部分功能无法正常工作
- [x] **解决方案**：将main.js的DOMContentLoaded事件监听器改为在模块加载完成后执行
- [x] **实施修复**：修改main.js，使用模块加载完成后的回调来执行初始化逻辑
- [x] **测试验证**：确认所有功能在正确的加载顺序下正常工作

**修改详情：**
- 重构main.js，移除DOMContentLoaded事件监听器，创建initializeApp()函数
- 在index.html中模块加载完成后调用window.initializeApp()
- 添加缺失的智能线路选择器change事件监听器和公告按钮创建功能
- 修复PerformanceMonitor类缺少measure方法的问题

**测试结果：** ✅ 功能完全正常，加载顺序问题已解决
- 控制台日志显示所有模块按正确顺序加载
- 智能线路选择器正常工作，change事件监听器已添加
- 公告按钮正确显示在页面右下角
- 开发者模式面板正常工作，性能监控错误已修复

## 修复"# 符号不会应用到URL里"问题 ✅ 已完成
- [x] **问题分析**：导航链接点击事件中使用了`e.preventDefault()`阻止默认行为，但没有手动更新URL中的哈希值
- [x] **问题定位**：在`src/main.js`的导航链接事件处理中，缺少`window.location.hash = targetId`代码
- [x] **解决方案**：在导航链接点击事件处理中添加URL哈希更新逻辑
- [x] **实施修复**：修改`src/main.js`中的导航链接事件处理函数
- [x] **测试验证**：确认点击导航链接时URL中的#符号正确更新

**问题详情：**
- 当前导航链接的href属性正确设置为`#home`、`#downloads`等格式
- 点击事件使用`e.preventDefault()`阻止了默认的哈希导航行为
- 但代码没有手动更新`window.location.hash`，导致URL中的#符号不更新
- 虽然页面内容切换正常，但URL不会反映当前页面状态

**修复计划：**
1. ✅ 在导航链接点击事件处理中添加`window.location.hash = targetId`
2. ✅ 确保哈希更新不会触发hashchange事件的无限循环
3. ✅ 测试所有导航链接的URL更新功能

**测试验证结果：**
- 主页链接：http://localhost:5500/#home ✅
- 下载链接：http://localhost:5500/#downloads ✅  
- 校验链接：http://localhost:5500/#verification ✅
- 赞助链接：http://localhost:5500/#sponsors ✅
- 关于链接：http://localhost:5500/#about ✅
