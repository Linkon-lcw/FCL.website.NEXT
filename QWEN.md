# Qwen 上下文：FCL 下载站 (FCL.website.NEXT)

**重要提示：** 此文件 (`QWEN.md`) 是项目开发的上下文和指令中心。**每次对项目进行重大修改或添加新功能时，都必须同步更新此文件，以确保其内容与项目当前状态保持一致。**

**同样重要：** `todo.md` 文件用于跟踪具体的开发任务和进度。**在完成任何任务或添加新任务时，请务必更新 `todo.md` 文件。**

## 项目概述

这是一个用于重构现有 FCL (Fold Craft Launcher) 下载站 (`/old` 目录) 的项目。目标是创建一个现代化、高性能、响应式且易于维护的网站。

### 现有项目 (`/old`) 简介

- **项目名称**: FCL.website.mdui
- **项目介绍**: 由玩家社区搭建的非官方 FCL 公益下载站，提供 FCL、ZL 启动器及其相关资源的下载。
- **技术栈**:
  - **前端框架**: MDUI (Material Design for Web)
  - **HTML/CSS/JS**: 原生 HTML, CSS (包含 `mdui.min.css` 和自定义 `main.css`), JavaScript (ES6 模块化)
  - **依赖库**:
    - `mdui.min.js`: MDUI JavaScript 库
    - `gt4.js`: 可能是极验滑动验证码
    - `eruda.js`: 移动端调试工具 (仅在 debug 模式下加载)
    - `ionicons`: 图标库
    - `vercount.one/js`: 网站计数器
    - `crypto-js`: 加密库
    - `launcher-sdk.js`: 外部 SDK (异步加载)
    - `browser-helper.min.js`: 用于设备信息检测
  - **构建方式**: 静态网站，无需后端。
- **特点**:
  - 采用模块化 JavaScript (`main.js` 作为入口，动态导入 `modules` 目录下的功能模块)。
  - 使用 JSON 文件或外部 API 作为数据源 (`file_tree.json` 等)。
  - 包含多种下载线路，根据用户选择或自动检测设备信息提供下载链接。
  - 有加载提示、延迟加载、预渲染等性能优化尝试。
  - 存在一些老旧代码和随意的命名规范。
  - 项目自述中提到站长开发环境受限（手机开发），代码可能存在一些“能跑就行”的风格。

### 重构目标 (`/` 目录)

根据 `todo.md` 和 `网页设计指南.md`，重构的目标包括：

1. **UI 重设计**:
   - 彻底抛弃旧的 MDUI 样式。
   - 采用现代化设计，主题色为青绿色 (`teal`)。
   - 严格遵循《网页设计指南》，确保响应式、无障碍、高性能（Core Web Vitals）。
2. **技术栈升级**:
   - 使用 **Tailwind CSS** 作为主要样式框架。
   - 使用 **FontAwesome** 作为图标库。
3. **功能保留与重写**:
   - 仅保留“下载”功能，其他旧功能（如校验、赞助列表等）暂留接口。
   - 重写所有 JavaScript 逻辑，不复制旧代码。
4. **新功能开发**:
   - **线路延迟检测**: 自动检测各个下载线路的延迟。
   - **智能线路选择**: 根据延迟自动选择最快的线路作为首页“开门见山”的默认下载源。
   - **设备检测**: 实现类似旧代码的设备检测逻辑，以优化用户体验。
5. **代码质量与结构**:
   - 仅重建需要的内容。
   - 保持良好的目录结构和可拓展性。

## 核心需求与指导原则

### 《网页设计指南》核心原则（基于网页设计指南.md）

- **用户中心设计**：可用性优先，15秒黄金法则。
- **视觉与体验**：视觉清晰，一致性，适度动态交互。
- **技术与性能**：卓越性能（Core Web Vitals），响应式，无障碍（WCAG 2.1 AA）。

### `todo.md` 具体任务

- 熟悉旧网页结构和功能。
- 重构 UI，使用 Tailwind CSS + FontAwesome，青绿色主题。
- 重写 JS，不复制旧代码。
- 保留下载功能，为其他功能留接口。
- 实现线路延迟检测与智能选择。
- 实现设备检测逻辑。
- 保持可拓展性和良好目录结构。

## 目录结构 (当前状态)

当前工作目录 `F:\Dev\Web\FCL.website.NEXT` 包含：

- `old/`: 存放待重构的旧版网站代码。
- `网页设计指南.md`: 项目设计指导原则。
- `todo.md`: 本次重构的具体任务列表。
- `.gitattributes`, `.git/`: Git 版本控制文件。
- `QWEN.md`: 本文件，记录项目上下文。
- `index.html`: 新网站的主页。
- `src/`: 新网站的源代码目录。
  - `main.js`: 新网站的主入口文件。
  - `modules/`: 新网站的功能模块目录。
    - `autoLineSelection.js`: 智能线路选择逻辑。
    - `deviceDetection.js`: 设备检测逻辑。
    - `downloadWays.js`: 下载线路数据源映射表。
    - `downloads.js`: 下载模块功能。
    - `indexDownLinks.js`: 开门见山下载链接设置。
    - `latencyCheck.js`: 线路延迟检测功能。

重构后的代码已经放在 `F:\Dev\Web\FCL.website.NEXT` 根目录下，形成了新的网站结构。

## 开发约定与流程

1. **阅读并理解** `网页设计指南.md` 和 `todo.md`。
2. **分析** `old` 目录下的代码，特别是 `index.html`, `js/main.js` 及其模块 (`js/modules/`)。
3. **设计** 新的 UI 和架构，遵循指南。
4. **开发** 使用 Tailwind CSS 和 FontAwesome 进行前端开发。
5. **实现** 新功能（延迟检测、智能选择、设备检测）。
6. **测试** 在不同设备和浏览器上确保响应式和功能正确。
7. **优化** 性能，确保满足 Core Web Vitals 标准。

## 项目完成状态

所有 `todo.md` 中的任务均已基本完成：

- [x] 熟悉旧网页结构和功能。
- [x] 重构 UI，使用 Tailwind CSS + FontAwesome，青绿色主题。
- [x] 重写 JS，不复制旧代码。
- [x] 保留下载功能，为其他功能留接口。
- [x] 实现线路延迟检测与智能选择。
- [x] 实现设备检测逻辑。
- [x] 保持可拓展性和良好目录结构。
- [x] 构建纯静态网站。

## 当前正在进行的工作

### 下载页面折叠面板优化
- **目标**: 实现两层折叠结构，外层是线路面板，内层是版本面板
- **状态**: 基本完成，但存在一些细节问题需要调整
- **相关文件**: 
  - `src/modules/downloads.js`
- **需要调整的问题**:
  1. 折叠面板的 `max-height` 计算问题
  2. Padding 对折叠动画的影响
  3. 确保动画平滑性和性能

### 折叠面板实现细节
- **外层折叠面板**（线路面板）
  - 点击线路标题可以展开或折叠整个线路的内容
  - 包含一个内容区域，其中有一个用于加载线路内容的`div`
- **内层折叠面板**（版本面板）
  - 在`loadFclDownWay`函数中，为每个版本创建独立的可折叠面板
  - 点击版本标题可以展开或折叠该版本的架构按钮
- **动画效果**
  - 通过CSS的`transition`属性和JavaScript动态控制`max-height`来实现